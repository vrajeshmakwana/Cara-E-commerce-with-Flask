<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* Custom animations */
    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideUp {
        from {
            transform: translateY(10px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    @keyframes shimmer {
        0% {
            background-position: -200px 0;
        }

        100% {
            background-position: calc(200px + 100%) 0;
        }
    }

    .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }

    .animate-slide-up {
        animation: slideUp 0.3s ease-out;
    }

    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .animate-spin {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(360deg);
        }
    }

    /* Skeleton loader shimmer effect */
    .skeleton-shimmer {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200px 100%;
        animation: shimmer 1.5s infinite;
    }

    /* Hover effects */
    .hover-lift:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    /* Loading states */
    .loading {
        opacity: 0.7;
        pointer-events: none;
    }

    /* Modal backdrop blur */
    .modal-backdrop {
        backdrop-filter: blur(4px);
    }

    /* Toast animations */
    .toast-enter {
        transform: translateX(100%);
        opacity: 0;
    }

    .toast-enter-active {
        transform: translateX(0);
        opacity: 1;
        transition: all 0.3s ease-out;
    }

    .toast-exit {
        transform: translateX(0);
        opacity: 1;
    }

    .toast-exit-active {
        transform: translateX(100%);
        opacity: 0;
        transition: all 0.3s ease-in;
    }

    /* Star rating hover effects */
    .star-btn:hover {
        transform: scale(1.1);
    }

    /* Form input focus effects */
    input:focus,
    textarea:focus {
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
        .container {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* Modal adjustments for mobile */
        #reviewModal .max-w-md {
            max-width: calc(100vw - 2rem);
            margin: 1rem;
        }

        /* Thumbnail grid adjustments */
        .grid-cols-4 {
            gap: 0.5rem;
        }
    }

    /* Smooth transitions for all interactive elements */
    * {
        transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 150ms;
    }

    /* Custom button styles */
    .btn-primary {
        @apply bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors;
    }

    .btn-secondary {
        @apply bg-gray-100 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors;
    }

    /* Review card animations */
    .review-card {
        transform: translateY(20px);
        opacity: 0;
        animation: slideInUp 0.5s ease-out forwards;
    }

    @keyframes slideInUp {
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* Loading spinner */
    .spinner {
        border: 2px solid #f3f3f3;
        border-top: 2px solid #3498db;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
    }

    /* Success checkmark animation */
    @keyframes checkmark {
        0% {
            transform: scale(0);
        }

        50% {
            transform: scale(1.2);
        }

        100% {
            transform: scale(1);
        }
    }

    .checkmark {
        animation: checkmark 0.3s ease-out;
    }
</style>
{% extends 'inheritance.html' %}

{% block body %}

<!-- Loading Overlay -->
<div id="loadingOverlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
    <div class="text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
        <p class="text-gray-600">Loading amazing products...</p>
    </div>
</div>

<!-- Main Content -->
<div id="mainContent" class="container mx-auto px-4 py-8 max-w-7xl opacity-0 transition-opacity duration-500">
    <!-- Product Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 mb-12">

        <!-- Left Side - Product Images -->
        <div class="space-y-4">

            <!-- Main Product Image -->
            {% for image in images %}
            {% if image.is_main == 1 %}
            <div id="mainImageContainer"
                class="aspect-square bg-white rounded-2xl shadow-lg overflow-hidden  transition-opacity duration-500">
                <img id="mainImage" src="{{image.url}}" alt="Premium Sneaker"
                    class="w-full h-full object-cover transition-all duration-300 hover:scale-105" />
                {% endif %}
                {% endfor %}

            </div>



            <!-- Thumbnail Images -->
            <div id="thumbnailsContainer" class="grid grid-cols-4 gap-3 opacity-0 transition-opacity duration-500"
                style="opacity: 1;">
                {% if images %}
                {% for image in images %}
                {% if image.is_main == 0 %}

                <div class="thumbnail-container aspect-square bg-white rounded-lg shadow-md overflow-hidden cursor-pointer border-2 transition-all duration-200 hover:shadow-lg border-blue-500"
                    data-image="{{image.url}}">
                    <img id="subimage" src="{{image.url}}" alt="image 1" class="w-full h-full object-cover">
                </div>
                {% endif %}

                {% endfor %}
                {% endif %}
            </div>
        </div>
        <!-- Right Side - Product Details -->
        <div class="space-y-6">
            <!-- Product Title and Price Skeleton -->
            <div id="titleSkeleton" class="space-y-3">
                <div class="h-8 bg-gray-200 rounded animate-pulse"></div>
                <div class="h-6 bg-gray-200 rounded w-2/3 animate-pulse"></div>
                <div class="flex space-x-3">
                    <div class="h-8 bg-gray-200 rounded w-20 animate-pulse"></div>
                    <div class="h-6 bg-gray-200 rounded w-16 animate-pulse"></div>
                    <div class="h-6 bg-gray-200 rounded w-16 animate-pulse"></div>
                </div>
            </div>

            <!-- Product Title and Price -->
            <div id="titleContainer" class="space-y-2 opacity-0 transition-opacity duration-500">
                <h1 class="text-3xl lg:text-4xl font-bold text-gray-900">{{ProductDetails.Name}}</h1>
                <div class="flex items-center space-x-3">
                    {% if ProductDetails %}

                    <span class="text-3xl font-bold text-blue-600">â‚¹{{ProductDetails.Discounted_Price}}</span>
                    <span class="text-lg text-gray-500 line-through">â‚¹{{ProductDetails.Original_Price}}</span>
                    {% endif %}
                    {% set discountPercentage = ((ProductDetails.Original_Price - ProductDetails.Discounted_Price) /
                    ProductDetails.Original_Price)*100 %}
                    <span
                        class="bg-red-100 text-red-800 px-2 py-1 rounded-md text-sm font-medium">{{discountPercentage|round(0,'common')|int}}%
                        OFF</span>
                </div>
            </div>

            <!-- Product Rating Skeleton -->
            <div id="ratingSkeleton" class="flex items-center space-x-2">
                <div class="h-5 bg-gray-200 rounded w-24 animate-pulse"></div>
                <div class="h-4 bg-gray-200 rounded w-8 animate-pulse"></div>
                <div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div>
            </div>

            <!-- Product Rating -->
            {% set full_stars = ProductDetails.Ratings|int %}
            {% set remainder = ProductDetails.Ratings - full_stars %}

            {% if remainder >= 0.75 %}
            {% set full_stars = full_stars + 1 %}
            {% set half_star = 0 %}
            {% elif remainder >= 0.25 %}
            {% set half_star = 1 %}
            {% else %}
            {% set half_star = 0 %}
            {% endif %}

            {% set empty_stars = 5 - full_stars - half_star %}

            <div id="ratingContainer" class="flex items-center space-x-2 opacity-0 transition-opacity duration-500">
                <div class="flex text-yellow-400">
                    <!-- Full star -->
                    {% for i in range(full_stars) %}
                    <span><i class="fa-solid fa-star"></i></span>
                    {% endfor %}
                    <!-- Half star -->
                    {% if half_star %}
                    <span><i class="fa-solid fa-star-half-stroke"></i></span>
                    {% endif %}
                    {% if empty_stars %}
                    <i class="fa-regular fa-star"></i>
                    {% endif %}
                </div>
                <span class="text-gray-600">({{ProductDetails.Ratings}})</span>
                <span class="text-gray-400">â€¢</span>
                <span class="text-gray-600"><span id="reviewCount">128</span> reviews</span>
            </div>

            <!-- Product Description Skeleton -->
            <div id="descriptionSkeleton" class="space-y-2">
                <div class="h-4 bg-gray-200 rounded animate-pulse"></div>
                <div class="h-4 bg-gray-200 rounded animate-pulse"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4 animate-pulse"></div>
            </div>

            <!-- Product Description -->
            <div id="descriptionContainer" class="opacity-0 transition-opacity duration-500">
                <p class="text-gray-700 leading-relaxed">
                    {{ProductDetails.Description}}
                </p>
            </div>

            <!-- Size Selection -->
            <div class="space-y-3">
                <h3 class="font-semibold text-gray-900">Size</h3>
                <div class="flex flex-wrap gap-2">
                    {% if sizes %}
                    {% for size in sizes %}
                    <button
                        class="size-btn px-4 py-2 border-2 border-gray-300 rounded-lg font-medium transition-all duration-200 hover:border-blue-500 hover:bg-blue-50"
                        data-size="{{size}}">{{size}}</button>
                    {% endfor %}
                    {% endif %}

                </div>
            </div>

            <!-- Color Selection -->
            <div class="space-y-3">
                <h3 class="font-semibold text-gray-900">Color</h3>
                <div class="flex space-x-3">
                    {% for color in colors %}

                    <button id="colorBtn"
                        class="color-btn w-8 h-8 rounded-full border-2 border-gray-300 transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-{{color| lower}}-500"
                        style="background-color: {{color}} ;" data-color="{{color}}"></button>
                    {% endfor %}

                </div>
            </div>

            <!-- Quantity and Add to Cart -->
            <div class="space-y-4">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center border border-gray-300 rounded-lg">
                        <button id="decreaseQty"
                            class="px-3 py-2 text-gray-600 focus:outline-none hover:text-gray-800 transition-colors">-</button>
                        <span id="quantity" class="px-4 py-2 font-medium">1</span>
                        <button id="increaseQty"
                            class="px-3 py-2 text-gray-600 hover:text-gray-800 focus:outline-none  ">+</button>
                    </div>
                    <span class="text-gray-600">In Stock</span>
                </div>

                <button id="addToCart"
                    class="w-full bg-green-600 text-white py-3 px-6 rounded-lg font-semibold text-lg transition-all duration-200 hover:bg-blue-700 hover:shadow-lg transform hover:-translate-y-0.5 active:translate-y-0">
                    Add to Cart
                </button>
            </div>

            <!-- Additional Info -->
            <div class="border-t pt-6 space-y-3">
                <div class="flex items-center space-x-3 text-gray-600">
                    <span>ðŸšš</span>
                    <span>Free shipping on orders over â‚¹100</span>
                </div>
                <div class="flex items-center space-x-3 text-gray-600">
                    <span>ðŸ”„</span>
                    <span>30-day return policy</span>
                </div>
                <div class="flex items-center space-x-3 text-gray-600">
                    <span>âœ…</span>
                    <span>2-year warranty included</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs Section -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <!-- Tab Navigation -->
        <div class="border-b border-gray-200">
            <nav class="flex space-x-8 px-6">
                <button
                    class="tab-btn py-4 px-2 outline-none focus:outline-none text-blue-600 font-medium  transition-all duration-200"
                    data-tab="description">
                    Description
                </button>
                <button
                    class="tab-btn py-4 px-2 outline-none focus:outline-none border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium transition-all duration-200"
                    data-tab="reviews">
                    Reviews ({{reviews | count}})
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div class="p-6">
            <!-- Description Tab -->
            <div id="description" class="tab-content animate-fade-in">
                <div class="space-y-4">
                    <h3 class="text-xl font-semibold text-gray-900">Product Features</h3>
                    <ul class="space-y-2 text-gray-700">
                        {% for feature in features %}

                        <li class="flex items-start space-x-2">
                            <span class="text-blue-500 mt-1">â€¢</span>
                            <span>{{feature}}</span>
                        </li>
                        {% endfor %}

                    </ul>

                    <h3 class="text-xl font-semibold text-gray-900 pt-4">Care Instructions</h3>
                    <p class="text-gray-700">
                        Clean with a soft brush and mild soap. Allow to air dry naturally. Avoid direct sunlight and
                        heat sources.
                        Store in a cool, dry place when not in use.
                    </p>
                </div>
            </div>

            <!-- Reviews Tab -->
            <div id="reviews" class="tab-content hidden">
                <div class="space-y-6">
                    <div class="flex items-center justify-between pb-4 border-b">
                        <h3 class="text-xl font-semibold text-gray-900">Customer Reviews</h3>
                        <button id="writeReviewBtn"
                            class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                            Write Review
                        </button>
                    </div>

                    <!-- Reviews Container -->
                    <div id="reviewsContainer" class="space-y-4">
                        <!-- Review Item -->
                        {% for review in reviews %}
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">

                                    <span class="font-medium text-gray-900">{{review.name}}</span>
                                    <span class="text-yellow-400">{{"â˜…"*review.Rating}}</span>
                                </div>
                                <span class="text-gray-500 text-sm">2 days ago</span>
                            </div>
                            <p class="text-gray-700">
                                {{review.feedback}}
                            </p>
                            <div id="btnContainer" class="flex  justify-end items-center space-x-2">
                                <!-- Edit Button -->
                                <a href="/editReview/{{review.id}}"
                                    class="flex items-center px-4 py-2 bg-blue-500 text-white font-medium rounded-full shadow-md hover:bg-blue-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                                    <!-- Edit SVG icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                        fill="currentColor">
                                        <path
                                            d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-3.5 3.5a1.5 1.5 0 012.12-.03l.995.995-2.12 2.12-.995-.995a1.5 1.5 0 01.03-2.12z" />
                                        <path fill-rule="evenodd"
                                            d="M2 13.5V17a1 1 0 001 1h3.5a1 1 0 00.707-.293l8.657-8.657-3.535-3.535-8.657 8.657A1 1 0 002 13.5zm11.414-8.414a1 1 0 010 1.414l-9 9a1 1 0 01-1.414-1.414l9-9a1 1 0 011.414 0z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    <span>Edit</span>
                                </a>

                                <!-- Delete Button -->
                                <a href="#" data-id="{{review.id}}" id="DeleteBtn"
                                    class="flex items-center px-4 py-2 bg-red-500 text-white font-medium rounded-full shadow-md hover:bg-red-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                                    <!-- Delete SVG icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                        fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    <span>Delete</span>
                                </a>
                            </div>
                        </div>

                        {% endfor %}


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Write Review Modal -->
<div id="reviewModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0"
        id="reviewModalContent">
        <div class="p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Write a Review</h2>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <form id="reviewForm" action="/submit-feedback" class="space-y-4">
                <!-- Name Input -->
                <div>
                    <label for="reviewerName" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                    <input type="text" id="reviewerName" name="reviewerName" required
                        class="w-full px-3 py-2 border-0 rounded-lg  focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition duration-200"
                        placeholder="Enter your name">

                </div>

                <!-- Rating Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Rating</label>
                    <div class="flex space-x-1">
                        <button type="button"
                            class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors"
                            data-rating="1">â˜…</button>
                        <button type="button"
                            class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors"
                            data-rating="2">â˜…</button>
                        <button type="button"
                            class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors"
                            data-rating="3">â˜…</button>
                        <button type="button"
                            class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors"
                            data-rating="4">â˜…</button>
                        <button type="button"
                            class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors"
                            data-rating="5">â˜…</button>
                    </div>
                    <input type="hidden" id="selectedRating" name="rating" required>
                </div>

                <!-- Review Text -->
                <div>
                    <label for="reviewText" class="block text-sm font-medium text-gray-700 mb-1">Your Review</label>
                    <textarea id="reviewText" name="reviewText" rows="4" required
                        class="w-full px-3 py-2 border-0 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none transition duration-200"
                        placeholder="Share your experience with this product..."></textarea>
                </div>

                <!-- Submit Button -->
                <div class="flex space-x-3 pt-4">
                    <button type="button" id="cancelReview"
                        class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        Submit Review
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Success Toast -->
<!-- <div id="successToast"
    class="fixed top-28 left-28 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50">
    <div class="flex items-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>Review submitted successfully!</span>
    </div>
</div> -->

<script>
    // Taking an confirmation before deleting the user Feedback
    const deleteBtn = document.querySelectorAll("#DeleteBtn")
    deleteBtn.forEach((btn) => btn.addEventListener("click", () => {
        const deleteID = btn.getAttribute("data-id")
        let flag = confirm("Are you sure you want to remove your feedback")
        if (flag) {
            window.location.href = `/deleteReview/${deleteID}`
        }
    }))

    // Global variables
    let thumbnailsLoaded = 0;


    // Skeleton loader functionality
    function initSkeletonLoaders() {
        // Simulate loading time
        setTimeout(() => {
            // Show title content
            document.getElementById('titleSkeleton').style.display = 'none';
            document.getElementById('titleContainer').style.opacity = '1';

            // Show rating content
            document.getElementById('ratingSkeleton').style.display = 'none';
            document.getElementById('ratingContainer').style.opacity = '1';

            // Show description content
            document.getElementById('descriptionSkeleton').style.display = 'none';
            document.getElementById('descriptionContainer').style.opacity = '1';

            // Hide loading overlay and show main content
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    document.getElementById('mainContent').style.opacity = '1';
                }, 300);
            }, 500);
        }, 1500);
    }

    // Check if all thumbnails are loaded
    function checkAllThumbnailsLoaded() {
        thumbnailsLoaded++;
        if (thumbnailsLoaded >= 4) {
            document.getElementById('thumbnailsSkeleton').style.display = 'none';
            document.getElementById('thumbnailsContainer').style.opacity = '1';
        }
    }

    // Initialize image loading event listeners
    function initImageLoading() {
        // Main image load event
        const mainImage = document.getElementById('mainImage');
        const mainImageContainer = document.getElementById('mainImageContainer');
        const mainImageSkeleton = document.getElementById('mainImageSkeleton');

        // mainImage.addEventListener('load', () => {
        //     mainImageContainer.style.opacity = '1';
        //     mainImageSkeleton.style.display = 'none';
        // });

        // Thumbnail images load events
        const thumbnailImages = document.querySelectorAll('#thumbnailsContainer img');
        thumbnailImages.forEach(img => {
            img.addEventListener('load', checkAllThumbnailsLoaded);
        });
    }

    // Image thumbnail functionality
    function initImageGallery() {
        const mainImage = document.getElementById('mainImage');
        const thumbnails = document.querySelectorAll('.thumbnail-container');

        thumbnails.forEach(thumbnail => {
            thumbnail.addEventListener('click', () => {
                const newImageSrc = thumbnail.dataset.image;
                console.log(newImageSrc);


                // Update main image with fade effect
                mainImage.style.opacity = '0.7';
                setTimeout(() => {
                    mainImage.src = newImageSrc;
                    mainImage.style.opacity = '1';
                }, 150);

                // Update thumbnail selection
                thumbnails.forEach(t => {
                    t.classList.remove('border-blue-500');
                    t.classList.add('border-transparent');
                });
                thumbnail.classList.remove('border-transparent');
                thumbnail.classList.add('border-blue-500');
            });
        });
    }

    // Size selection functionality
    function initSizeSelection() {
        const sizeButtons = document.querySelectorAll('.size-btn');

        sizeButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active state from all buttons
                sizeButtons.forEach(btn => {
                    btn.classList.remove('border-blue-500', 'bg-blue-50', 'text-blue-700');
                    btn.classList.remove("ring-2", "ring-blue-500")
                    btn.classList.add('border-gray-300');
                });

                // Add active state to clicked button
                button.classList.remove('border-gray-300');
                button.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-700');
            });
        });
    }

    // Color selection functionality
    function initColorSelection() {
        const colorButtons = document.querySelectorAll('.color-btn');

        colorButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active state from all buttons
                colorButtons.forEach(btn => {
                    btn.classList.remove('ring-2', 'ring-blue-200', 'border-blue-500');
                    btn.classList.add('border-gray-300');
                });

                // Add active state to clicked button
                button.classList.remove('border-gray-300');
                button.classList.add('border-blue-500', 'ring-2', 'ring-blue-200');
            });
        });
    }

    // Quantity functionality
    function initQuantityControls() {
        const quantitySpan = document.getElementById('quantity');
        const decreaseBtn = document.getElementById('decreaseQty');
        const increaseBtn = document.getElementById('increaseQty');
        let quantity = 1;

        decreaseBtn.addEventListener('click', () => {
            if (quantity > 1) {
                quantity--;
                quantitySpan.textContent = quantity;
                quantitySpan.classList.add('animate-slide-up');
                setTimeout(() => quantitySpan.classList.remove('animate-slide-up'), 300);
            }
        });

        increaseBtn.addEventListener('click', () => {
            if (quantity < 10) {
                quantity++;
                quantitySpan.textContent = quantity;
                quantitySpan.classList.add('animate-slide-up');
                setTimeout(() => quantitySpan.classList.remove('animate-slide-up'), 300);
            }
        });
    }

    // Add to cart functionality
    function initAddToCart() {
        const addToCartBtn = document.getElementById('addToCart');

        addToCartBtn.addEventListener('click', () => {
            // Get selected options
            const selectedSize = document.querySelector('.size-btn.bg-blue-50')?.dataset.size || 'L';
            const selectedColor = document.querySelector('.color-btn.ring-2')?.dataset.color || 'blue';
            const quantity = document.getElementById('quantity').textContent;

            // Show success animation
            const originalText = addToCartBtn.textContent;
            addToCartBtn.textContent = 'Added to Cart!';
            addToCartBtn.classList.add('bg-green-600');
            addToCartBtn.classList.remove('bg-blue-600');

            // Reset after 2 seconds
            setTimeout(() => {
                addToCartBtn.textContent = originalText;
                addToCartBtn.classList.remove('bg-green-600');
                addToCartBtn.classList.add('bg-blue-600');
            }, 2000);

            // Log the selection (in a real app, this would be sent to the server)
            console.log(`Added to cart: Size ${selectedSize}, Color ${selectedColor}, Quantity ${quantity}`);
        });
    }
    // Changing product Images as soon as clicking on the image 
    const mainImage = document.getElementById("mainImage")
    const subimages = document.querySelectorAll("#subimage")
    const colorBtns = document.querySelectorAll("#colorBtn")
    const thumbnails = document.querySelectorAll('.thumbnail-container');

    colorBtns.forEach((colorBtn) => {
        colorBtn.addEventListener("click", async () => {
            // Now Making an post request
            let colorName = colorBtn.getAttribute("data-color")
            const option = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(colorName)
            }
            const response = await fetch("http://127.0.0.1:5000/color", option)
            const data = await response.json()
            console.log(data);
            mainImage.src = data.mainImage
            let count = 1
            let thumbnailCounter = 0
            subimages.forEach((image) => {
                image.src = data[`subImg${count}`]
                thumbnails[thumbnailCounter].dataset.image = data[`subImg${count}`]
                count += 1
                thumbnailCounter += 1

            })



        })
    })




    // Tab functionality
    function initTabs() {
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.dataset.tab;

                // Update button states
                tabButtons.forEach(btn => {
                    btn.classList.remove('border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                button.classList.remove('border-transparent', 'text-gray-500');
                button.classList.add('border-blue-500', 'text-blue-600');

                // Update content visibility
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                    content.classList.remove('animate-fade-in');
                });

                const targetContent = document.getElementById(targetTab);
                targetContent.classList.remove('hidden');
                targetContent.classList.add('animate-fade-in');
            });
        });
    }

    // Review modal functionality
    function initReviewModal() {
        const writeReviewBtn = document.getElementById('writeReviewBtn');
        const reviewModal = document.getElementById('reviewModal');
        const reviewModalContent = document.getElementById('reviewModalContent');
        const closeModal = document.getElementById('closeModal');
        const cancelReview = document.getElementById('cancelReview');
        const reviewForm = document.getElementById('reviewForm');
        const starButtons = document.querySelectorAll('.star-btn');
        const selectedRatingInput = document.getElementById('selectedRating');
        const successToast = document.getElementById('successToast');

        let selectedRating = 0;

        // Open modal
        writeReviewBtn.addEventListener('click', () => {
            reviewModal.classList.remove('hidden');
            setTimeout(() => {
                reviewModalContent.classList.remove('scale-95', 'opacity-0');
                reviewModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        });

        // Close modal function
        function closeReviewModal() {
            reviewModalContent.classList.remove('scale-100', 'opacity-100');
            reviewModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                reviewModal.classList.add('hidden');
                resetForm();
            }, 300);
        }

        // Close modal events
        closeModal.addEventListener('click', closeReviewModal);
        cancelReview.addEventListener('click', closeReviewModal);

        // Close modal when clicking outside
        reviewModal.addEventListener('click', (e) => {
            if (e.target === reviewModal) {
                closeReviewModal();
            }
        });

        // Star rating functionality
        starButtons.forEach((star, index) => {
            star.addEventListener('click', () => {
                selectedRating = index + 1;
                selectedRatingInput.value = selectedRating;

                // Update star display
                starButtons.forEach((s, i) => {
                    if (i < selectedRating) {
                        s.classList.remove('text-gray-300');
                        s.classList.add('text-yellow-400');
                    } else {
                        s.classList.remove('text-yellow-400');
                        s.classList.add('text-gray-300');
                    }
                });
            });

            // Hover effect
            star.addEventListener('mouseenter', () => {
                starButtons.forEach((s, i) => {
                    if (i <= index) {
                        s.classList.remove('text-gray-300');
                        s.classList.add('text-yellow-400');
                    } else {
                        s.classList.remove('text-yellow-400');
                        s.classList.add('text-gray-300');
                    }
                });
            });
        });

        // Reset stars on mouse leave
        document.querySelector('.flex.space-x-1').addEventListener('mouseleave', () => {
            starButtons.forEach((s, i) => {
                if (i < selectedRating) {
                    s.classList.remove('text-gray-300');
                    s.classList.add('text-yellow-400');
                } else {
                    s.classList.remove('text-yellow-400');
                    s.classList.add('text-gray-300');
                }
            });
        });

        // Form submission
        reviewForm.addEventListener('submit', async (e) => {
            const reviewsContainer = document.getElementById("reviewsContainer")
            e.preventDefault();

            const formData = new FormData(reviewForm);
            const reviewData = {
                productID: 1,
                name: formData.get('reviewerName'),
                rating: parseInt(formData.get('rating')),
                text: formData.get('reviewText'),
            };
            const res = await fetch("http://127.0.0.1:5000/get-csrf-token")
            const data = await res.json()
            const token = data.csrf_token
            const reviewResponse = await fetch("http://127.0.0.1:5000/submit-feedback", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRF-Token": token
                },
                body: JSON.stringify(reviewData)
            })
            const feedback = await reviewResponse.json()
            alert(feedback.message)
            console.log(feedback.data);
            const latest_review = `<div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">

                                    <span class="font-medium text-gray-900">${feedback.data.name}</span>
                                    <span class="text-yellow-400">${'â˜…'.repeat(feedback.data.rating)
                }</span >
                                </div >
            <span class="text-gray-500 text-sm">2 days ago</span>
                            </div >
            <p class="text-gray-700">
                ${feedback.data.feedback}
            </p>

                        </div >
            `
            reviewsContainer.insertAdjacentHTML("beforeend", latest_review)





            updateReviewCount();

            // Show success toast
            // showSuccessToast();

            // Close modal
            closeReviewModal();
        });


        // Reset form function
        function resetForm() {
            reviewForm.reset();
            selectedRating = 0;
            selectedRatingInput.value = '';
            starButtons.forEach(star => {
                star.classList.remove('text-yellow-400');
                star.classList.add('text-gray-300');
            });
        }
    }



    // Update review count
    function updateReviewCount() {
        const count = reviews.length;
        document.getElementById('reviewCount').textContent = count;
        document.getElementById('tabReviewCount').textContent = count;
    }

    // Show success toast
    function showSuccessToast() {
        const toast = document.getElementById('successToast');
        console.log(toast);

        toast.classList.remove('translate-x-full');
        toast.classList.add('translate-x-0');
        toast.classList.add("z-20")

        setTimeout(() => {
            toast.classList.remove('translate-x-0');
            toast.classList.add('translate-x-full');
        }, 3000);
    }

    // Initialize all functionality when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        initSkeletonLoaders();
        initImageLoading();
        initImageGallery();
        initSizeSelection();
        initColorSelection();
        initQuantityControls();
        initAddToCart();
        initTabs();
        initReviewModal();
        updateReviewCount();
    });

    // Add smooth scrolling for better UX
    document.documentElement.style.scrollBehavior = 'smooth';
</script>
{% endblock %}